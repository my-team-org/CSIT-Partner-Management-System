{% extends "base.html" %}
{% load static %}
{% block content %}
<div class="container">
  <div class="modal-title d-flex justify-content-between align-items-center">
    <h1>PDF Viewer</h1>
    <a href = "{% url 'index'%}" type="button" class="btn-close" ></a>
  </div>

  <!-- Display PDF -->
  <div class="pdf-container">
    <object data="{{ application_instance.pdf_file.url }}" type="application/pdf" width="100%" height="600px">
      <p>Your browser does not support PDFs. <a href="{{ application_instance.pdf_file.url }}">Download the PDF</a>.</p>
    </object>
  </div>

  <!-- Form to change comment and status -->
  <div class = "d-flex mx-2">
    <button id = "btnIncomplete" class = "btn btn-danger mx-2" style="width: 100%; margin-top: 10px;">
        ไม่ผ่าน
    </button>
    <button id = "btnComplete" class = "btn btn-success mx-2" style="width: 100%; margin-top: 10px;">
        ผ่าน
    </button>
</div>
<!-- พื้นที่แสดง textarea (ซ่อนไว้ก่อน) -->

    <div id="reasonContainer" class="mt-3 mx-2" style="display: none;">
        <form method = "POST" >
            {% csrf_token %}
            <textarea id="reasonInput" name = "reason" class="form-control" placeholder="เหตุผลที่ไม่ผ่าน..." value = "reasonOfDeny"></textarea>
            <button id="btnSubmitReason" class="btn btn-primary mt-2" style="width: 100%;" type = "submit" name="status_action" value="reject">Send</button>
        </form>
    </div>
    <!-- ปุ่มส่งข้อมูล (ซ่อนไว้ก่อน) -->

    <div id="submitCorrectContainer" class="mt-3 mx-2" style="display: none;">
        <form method = "POST">
            {% csrf_token %}
            <textarea id="reasonInput" name = "reason" class="form-control" placeholder="คำแนะนำเพิ่มเติม..." value = "moreReason"></textarea>
            <button id="btnSubmitCorrect" class="btn btn-primary mt-2" style="width: 100%;" type = "submit" name="status_action" value="approve">Send</button>
        </form>
    </div>

</div>
<script>
  document.getElementById("btnIncomplete").addEventListener("click", function () {
    document.getElementById("reasonContainer").style.display = "block";
    document.getElementById("submitCorrectContainer").style.display = "none";
  });

  document.getElementById("btnComplete").addEventListener("click", function () {
      document.getElementById("reasonContainer").style.display = "none";
      document.getElementById("reasonInput").value = "";
      document.getElementById("submitCorrectContainer").style.display = "block";
  });
  document.getElementById("btnSubmitReason").addEventListener("click", function () {
    sendApplicationUpdate("rejected");
  });

  document.getElementById("btnSubmitCorrect").addEventListener("click", function () {
      sendApplicationUpdate("approved");
  });

  document.getElementById("pdfModal").addEventListener("hidden.bs.modal", function () {
      document.getElementById("reasonContainer").style.display = "none";
      document.getElementById("reasonInput").value = "";
      document.getElementById("submitCorrectContainer").style.display = "none";
  });
</script>
{% endblock %}