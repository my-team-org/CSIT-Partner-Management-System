{% extends 'base.html' %}
{% load static %}

{% block title %}รีวิวบริษัทฝึกงาน{% endblock %}

{% block styleCustom %}
<style>
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: #f8f9fa;
        margin: 0;
        padding: 20px;
    }

    .container {
        max-width: 800px;
        margin: auto;
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
        animation: fadeIn 1s ease-in-out;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(-20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .form-group {
        margin-bottom: 15px;
    }

    label {
        font-weight: bold;
        display: block;
        margin-bottom: 5px;
    }

    input,
    select,
    textarea {
        width: calc(100% - 20px);
        padding: 10px;
        margin-bottom: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        resize: vertical;
    }

    input:focus,
    select:focus,
    textarea:focus {
        border-color: #FFC145;
        outline: none;
    }

    .star-rating {
        display: flex;
        gap: 5px;
        cursor: pointer;
    }

    .star-rating span {
        font-size: 1.5rem;
        color: #ccc;
        transition: color 0.3s, transform 0.3s;
    }

    .star-rating span.active,
    .star-rating span:hover,
    .star-rating span:hover~span {
        color: #ffd700;
        transform: scale(1.2);
    }

    button {
        display: block;
        margin: 20px auto;
        padding: 10px 50px;
        font-size: 16px;
        background-color: #FFC145;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        width: 50%;
        max-width: 400px;
        text-align: center;
    }

    button:hover {
        background-color: #FFAE00;
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <h2><i class="fas fa-pencil-alt"></i> เขียนรีวิวบริษัทฝึกงาน</h2>
    <form method="post">
        {% csrf_token %}
        <div class="form-group">
            <label><i class="fas fa-building"></i> ชื่อบริษัทที่ฝึกงาน</label>
            {{ form.company }}
        </div>
        <div class="form-group">
            <label><i class="fas fa-thumbs-up"></i> คุณจะแนะนำบริษัทนี้ให้กับผู้อื่นหรือไม่?</label>
            {{ form.recommend }}
        </div>
        <div class="form-group">
            <label><i class="fas fa-star"></i> คะแนนความพึงพอใจโดยรวม</label>
            <div class="star-rating" data-rating="0" data-input-id="id_overall_rating">
                <span data-value="1">★</span>
                <span data-value="2">★</span>
                <span data-value="3">★</span>
                <span data-value="4">★</span>
                <span data-value="5">★</span>
            </div>
            {{ form.overall_rating }}
        </div>
        <div class="form-group">
            <label><i class="fas fa-gift"></i> คะแนนสวัสดิการและผลประโยชน์</label>
            <div class="star-rating" data-rating="0" data-input-id="id_benefits_rating">
                <span data-value="1">★</span>
                <span data-value="2">★</span>
                <span data-value="3">★</span>
                <span data-value="4">★</span>
                <span data-value="5">★</span>
            </div>
            {{ form.benefits_rating }}
        </div>
        <div class="form-group">
            <label><i class="fas fa-users"></i> คะแนนบรรยากาศของที่ทำงาน</label>
            <div class="star-rating" data-rating="0" data-input-id="id_environment_rating">
                <span data-value="1">★</span>
                <span data-value="2">★</span>
                <span data-value="3">★</span>
                <span data-value="4">★</span>
                <span data-value="5">★</span>
            </div>
            {{ form.environment_rating }}
        </div>
        <div class="form-group">
            <label><i class="fas fa-chart-line"></i> คะแนนการบริหารจัดการองค์กร</label>
            <div class="star-rating" data-rating="0" data-input-id="id_management_rating">
                <span data-value="1">★</span>
                <span data-value="2">★</span>
                <span data-value="3">★</span>
                <span data-value="4">★</span>
                <span data-value="5">★</span>
            </div>
            {{ form.management_rating }}
        </div>
        <div class="form-group">
            <label><i class="fas fa-briefcase"></i> ประเภทงานที่ฝึก</label>
            <select class="review-select form-control">
                <option value="" selected disabled>กรุณาเลือกประเภทงาน</option>
                {% for jt in job_types %}
                    <option value="{{ jt }}">{{ jt }}</option>
                {% endfor %}
                <option value="อื่นๆ">อื่นๆ</option>
            </select>
            
            <textarea class="review-text form-control mt-2" rows="3" style="display: none;"
                placeholder="กรุณาระบุประเภทงานเพิ่มเติม"></textarea>

            <!-- ตัวจริงที่ Django จะรับค่า -->
            {{ form.job_type }}
        </div>
        <div class="form-group">
            <label><i class="fas fa-tasks"></i> หน้าที่ที่ได้รับมอบหมาย</label>
            {{ form.job_description }}
        </div>
        <div class="form-group">
            <label><i class="fas fa-book"></i> ประสบการณ์ที่คุณได้รับจากบริษัทนี้</label>
            {{ form.experience }}
        </div>
        <div class="form-group">
            <label><i class="fas fa-lightbulb"></i> คำแนะนำที่อยากให้กับผู้ฝึกงานรุ่นถัดไป</label>
            {{ form.advice }}
        </div>
        <button type="submit"><i class="fas fa-paper-plane"></i> ส่งรีวิว</button>
    </form>

    <h2><i class="fas fa-list"></i> รีวิวของฉัน</h2>
    <ul>
        {% for review in reviews %}
        <li>{{ review.company.name_th }} ({{ review.company.name_en }}) - {{ review.overall_rating }}
            ดาว(คะแนนภาพรวม)</li>
        {% endfor %}
    </ul>
</div>

<script>
    const form = document.querySelector("form");

    const jobSelect = document.querySelector(".review-select");
    const jobTextarea = document.querySelector(".review-text");
    const jobHiddenInput = document.getElementById("id_job_type");

    function toggleJobTypeInput() {
        if (jobSelect.value === "อื่นๆ") {
            jobTextarea.style.display = "block";
            jobTextarea.required = true;
            jobTextarea.value = "";
        } else {
            jobTextarea.style.display = "none";
            jobTextarea.required = false;
            jobTextarea.value = jobSelect.value;
        }
    }

    jobSelect.addEventListener("change", toggleJobTypeInput);
    window.addEventListener("DOMContentLoaded", toggleJobTypeInput);

    form.addEventListener("submit", function () {
        if (jobSelect.value === "อื่นๆ") {
            jobHiddenInput.value = jobTextarea.value;
        } else {
            jobHiddenInput.value = jobSelect.value;
        }
    });

    document.querySelectorAll('.star-rating span').forEach(span => {
        span.addEventListener('mouseover', function () {
            const rating = this.dataset.value;
            const stars = this.parentNode.querySelectorAll('span');
            stars.forEach(star => {
                star.style.color = star.dataset.value <= rating ? '#ffd700' : '#ccc';
                star.style.transform = star.dataset.value <= rating ? 'scale(1.2)' : 'scale(1)';
            });
        });

        span.addEventListener('mouseout', function () {
            const starRating = this.parentNode;
            updateStars(starRating);
        });

        span.addEventListener('click', function () {
            const rating = this.dataset.value;
            const starRating = this.parentNode;
            starRating.dataset.rating = rating;
            updateStars(starRating);
            document.getElementById(starRating.dataset.inputId).value = rating;
        });
    });

    function updateStars(starRating) {
        const rating = starRating.dataset.rating || 0;
        const stars = starRating.querySelectorAll('span');
        stars.forEach(star => {
            star.style.color = star.dataset.value <= rating ? '#ffd700' : '#ccc';
        });
    }
</script>
{% endblock %}